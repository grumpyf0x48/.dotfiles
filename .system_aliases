#!/usr/bin/env bash

export EDITOR=vi

export HISTCONTROL=erasedups:ignorespace
export HISTTIMEFORMAT='%F %T '
export HISTSIZE=100

alias c='clear'
alias h='history'
alias ports='netstat -tulanp'
alias update='sudo apt update && sudo apt upgrade && sudo apt autoremove'

function canonical_which() {
    if [ "$1" = "-a" ]; then
        \which -a "$2"
    else
        readlink -e "$(command -v "$1")"
    fi
}
alias which='canonical_which'

if command -v batcat >/dev/null; then
    alias bat='batcat'
    alias cat='bat --style=plain --pager=never'
    alias less='bat --style=plain'
fi

if [ -x "$HOME/Programs/umlet/Umlet/umlet.sh" ]; then
    alias umlet='~/Programs/umlet/Umlet/umlet.sh'
fi

if [ -d "$HOME/.sdkman" ]; then
    export SDKMAN_DIR="$HOME/.sdkman"
    if [ -s "$SDKMAN_DIR/bin/sdkman-init.sh" ]; then
        source "$SDKMAN_DIR/bin/sdkman-init.sh"
    fi
fi

function paged_jq() {
    # -F tell less exit if output content can be displayed on one screen
    # See: https://github.com/stedolan/jq/issues/764#issuecomment-379688272
    jq --color-output "$@" | less --quit-if-one-screen --RAW-CONTROL-CHARS
}
alias pjq='paged_jq'

function hist_rm_unknown_command() {
    if [ $? -eq 127 ]; then
        history -d $HISTCMD
    fi
}
trap hist_rm_unknown_command ERR
